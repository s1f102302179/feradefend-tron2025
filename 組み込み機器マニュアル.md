# STM32N6570-DKとサーボモータSG90接続マニュアル

## 1. プロジェクト概要
- **ボード**: STM32N6570-DK
- **MCU**: STM32N657X0H3Q (Cortex-M55)
- **用途**: 2個のSG90サーボモータによるパンチルト機構の制御

## 2. 使用するピンとタイマー設定

### サーボモータ制御用ピン（TIM1使用）
設定ファイルから、TIM1のPWM出力が2チャンネル設定されています：

- **TIM1_CH1**: パン（水平回転）制御用
- **TIM1_CH3**: チルト（垂直回転）制御用

### 該当するGPIOピン
- **PA9 (TIM1_CH1)** - パンサーボ用 = **D3**
- **PB13 (TIM1_CH3)** - チルトサーボ用 = **D6**

## 3. STM32CubeMX設定

### タイマー設定（TIM1）
 - モード: PWM Generation
 - チャンネル: CH1, CH3
 - プリスケーラ: 749
 - カウンタ周期: 1999
 - パルス値（初期値）: 75（両チャンネル）
### PWM周波数計算
- システムクロック: 400MHz（AXIクロック）
- TIM1クロック: 400MHz
- PWM周波数 = 400MHz / (750 × 2000) = 266.67Hz
- PWM周期 = 3.75ms

> **注意**: SG90の標準的な制御には20ms周期（50Hz）が必要です。設定の調整が必要な場合：
> ```
> プリスケーラ: 3999
> カウンタ周期: 1999
> → PWM周波数 = 50Hz（20ms周期）
> ```

### パルス幅設定（SG90制御）
- **0度**: パルス幅 0.5ms → パルス値 = 50
- **90度**: パルス幅 1.5ms → パルス値 = 150
- **180度**: パルス幅 2.5ms → パルス値 = 250

## 4. GPIO設定
```c
// PA9: TIM1_CH1（パンサーボ）
GPIO_InitTypeDef.Mode = GPIO_MODE_AF_PP;
GPIO_InitTypeDef.Pull = GPIO_NOPULL;
GPIO_InitTypeDef.Speed = GPIO_SPEED_FREQ_LOW;
GPIO_InitTypeDef.Alternate = GPIO_AF1_TIM1;
```

// PB13: TIM1_CH3（チルトサーボ）
// 同様の設定

## 5. 配線図
### 接続表

| STM32N6570-DK | SG90 サーボ #1（パン） | SG90 サーボ #2（チルト） |
|---------------|-------------------------|---------------------------|
| PA9 (D3)      | 信号線（橙）            | -                         |
| PB13 (D6)     | -                       | 信号線（橙）              |
| 5V            | 電源線（赤）            | 電源線（赤）              |
| GND           | GND線（茶）             | GND線（茶）               |

### 配線接続図
STM32N6570-DK                サーボモータ#1（パン）
┌─────────────┐              ┌──────────┐
│     D3  ────┼──────────────┤ 信号(橙) │
│             │              │          │
│      5V ────┼──────────────┤ VCC(赤)  │
│             │              │          │
│     GND ────┼──────────────┤ GND(茶)  │
└─────────────┘              └──────────┘

                             サーボモータ#2（チルト）
                             ┌──────────┐
│     D6  ────┼──────────────┤ 信号(橙) │
│             │              │          │
│      5V ────┼──────────────┤ VCC(赤)  │
│             │              │          │
│     GND ────┼──────────────┤ GND(茶)  │
└─────────────┘              └──────────┘
### ブレッドボード配線について
- STM32N6570-DKの**GND**をブレッドボードの**マイナスレール**に接続
- STM32N6570-DKの**5V**をブレッドボードの**プラスレール**に接続
- 配線図の色はサーボモータの実際の配線色に対応

## 6. 使用部品リスト
1. **STM32N6570-DK** × 1
2. **SG90サーボモータ** × 2
3. **ジャンパーワイヤー** × 6本（信号線2本、電源線2本、GND線2本）
4. **ブレッドボード** × 1
5. **パンチルト機構ブラケット** × 1セット（オプション）

## 7. 電源に関する注意事項
- **SG90の消費電流**:
  - 無負荷時: 約100mA
  - 負荷時最大: 650mA
- **2個使用時の最大電流**: 約1.3A
- **STM32N6570-DKの5V出力容量を確認し、必要に応じて外部電源を使用

## 8.　サンプルコード（HAL使用）
// サーボ初期化
HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_1); // パンサーボ
HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_3); // チルトサーボ

// パンサーボを90度に設定
__HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_1, 150);

// チルトサーボを45度に設定  
__HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_3, 100);

## 9. トラブルシューティング
 - サーボが動かない → 電源容量、配線、PWM周波数を確認
 - サーボが震える → PWM周期を正確に20msに調整
 - 可動範囲が狭い → パルス幅の範囲を0.5ms～2.5msに調整
